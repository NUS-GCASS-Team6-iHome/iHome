pipeline {
	agent any

	environment {
		dockerImage = ''
		registry = 'feifeiliang/booking-service-img'
		registryCredential='dockerid'
	}

	tools{
		maven "maven"
	}
	stages {
		stage('Build') {
			steps {
				// dir('/booking-service/')
				sh "pwd"
				dir('booking-service/') {
					sh 'mvn --version'
					sh 'mvn clean install -Dmaven.test.skip=true'
				}
				
				// -f booking-service/pom.xml
			}
		}
		stage('Build Docker Image') {
			steps {
				script{
					sh "pwd"
					dir('booking-service/') {
						dockerImage = docker.build registry
					}
				}
			}
		}
		stage ('Uploading Image'){
			steps {
				script {
					docker.withRegistry('', registryCredential){
						dockerImage.push()
					}

				}
			}
		}
	}

	post {
		always {
			cleanWs()
		}
	}
}